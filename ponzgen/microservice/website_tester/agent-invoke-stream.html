<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Invoke Stream - API Tester</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet">
    <style>
        .chat-container {
            min-height: 400px;
            max-height: 600px;
            overflow-y: auto;
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }
        
        .message {
            margin-bottom: 15px;
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 18px;
            position: relative;
            word-wrap: break-word;
        }
        
        .user-message {
            align-self: flex-end;
            background-color: #0d6efd;
            color: white;
            border-bottom-right-radius: 5px;
            margin-left: auto;
        }
        
        .agent-message {
            align-self: flex-start;
            background-color: #e9ecef;
            color: #212529;
            border-bottom-left-radius: 5px;
        }
        
        .status-container {
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 5px;
            background-color: #e9ecef;
        }
        
        .tool-status-container {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 15px;
        }
        
        .tool-status {
            margin: 5px 0;
            padding: 8px;
            border-radius: 5px;
            background-color: #e2f3ff;
            border-left: 4px solid #0d6efd;
            font-size: 0.85rem;
        }
        
        .tool-status.start {
            border-left-color: #198754;
        }
        
        .tool-status.end {
            border-left-color: #dc3545;
        }
        
        .message-time {
            font-size: 0.75rem;
            color: rgba(0,0,0,0.5);
            margin-top: 5px;
            text-align: right;
        }
        
        .user-message .message-time {
            color: rgba(255,255,255,0.8);
        }
        
        .loading-dots:after {
            content: '.';
            animation: dots 1.5s steps(5, end) infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60% { content: '...'; }
            80%, 100% { content: ''; }
        }
        
        .chat-input-container {
            display: flex;
            margin-top: 15px;
        }
        
        .chat-input {
            flex-grow: 1;
            border-radius: 20px;
            padding: 10px 15px;
            border: 1px solid #ced4da;
        }
        
        .send-button {
            margin-left: 10px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html">API Tester</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="user-info.html">User Info</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="companies.html">Companies</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="roles.html">Roles</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="tools.html">Tools</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="agents.html">Agents</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="agent-invoke.html">Agent Invoke</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="agent-invoke-stream.html">Agent Invoke Stream</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="agent-logs.html">Agent Logs</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <h1>Agent Invoke Stream</h1>
                <p>Test invoking agents with streaming responses</p>
            </div>
        </div>

        <div class="row mt-3">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Agent Selection</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="agent-select" class="form-label">Select Agent</label>
                            <select class="form-select" id="agent-select">
                                <option value="">Loading agents...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <button id="get-agent-info" class="btn btn-info">Get Agent Info</button>
                        </div>
                        <div id="agent-info-container" class="mt-3">
                            </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Agent Invocation</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="agent-context" class="form-label">Context (Optional)</label>
                            <textarea class="form-control" id="agent-context" rows="3" placeholder="Enter optional context for the agent"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="thread-id" class="form-label">Thread ID</label>
                            <input type="text" class="form-control" id="thread-id" placeholder="Thread ID for conversation continuity" value="1" required>
                            <small class="form-text text-muted">Required for conversation continuity. Default is "1".</small>
                        </div>
                        <div class="mb-3">
                            <label for="model-name" class="form-label">Model Name</label>
                            <select class="form-select" id="model-name">
                                <option value="">Loading available models...</option>
                            </select>
                            <small class="form-text text-muted">Models are loaded dynamically from the server</small>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="reset-memory">
                            <label class="form-check-label" for="reset-memory">Reset Memory</label>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="load-from-json" checked>
                            <label class="form-check-label" for="load-from-json">Load From JSON</label>
                        </div>
                        <div class="mb-3">
                            <label for="agent-style" class="form-label">Agent Style (Optional)</label>
                            <input type="text" class="form-control" id="agent-style" placeholder="Custom agent style">
                        </div>
                        <div class="d-grid gap-2">
                            <button id="update-settings" class="btn btn-outline-primary">Update Settings</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5>Chat</h5>
                        <button id="clear-response" class="btn btn-sm btn-outline-secondary">Clear Chat</button>
                    </div>
                    <div class="card-body">
                        <div id="status-container" class="status-container d-none">
                            <strong>Status:</strong> <span id="current-status">Waiting for response...</span>
                        </div>
                        <div id="tool-status-container" class="tool-status-container">
                            </div>
                        <div id="chat-container" class="chat-container">
                            <p class="text-center text-muted">Start a conversation with the agent</p>
                        </div>
                        
                        <div class="chat-input-container d-flex align-items-center">
                            <label class="btn btn-outline-secondary me-2" style="margin-bottom: 0;" title="Upload Image">
                                <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
                                    <path d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z"/>
                                </svg>
                                <input type="file" id="image-upload" accept="image/*" style="display: none;">
                            </label>
                            <input type="text" id="agent-message" class="form-control chat-input" placeholder="Type your message here...">
                            <button id="invoke-agent" class="btn btn-primary send-button">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576 6.636 10.07Zm6.787-8.201L1.591 6.602l4.339 2.76 7.494-7.493Z"/>
                                </svg>âž¤
                            </button>
                        </div>
                        <div id="image-preview" class="mt-2" style="display: none;">
                            <img id="preview-image" src="#" alt="Preview" style="max-height: 100px; max-width: 100px; border-radius: 4px; margin-right: 5px;">
                            <button id="remove-image" class="btn btn-sm btn-outline-danger">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                                </svg>
                            </button>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Request Details</h5>
                    </div>
                    <div class="card-body">
                        <h6>Request URL</h6>
                        <pre id="request-url" class="bg-light p-2 rounded">No request made yet</pre>
                        
                        <h6>Request Headers</h6>
                        <pre id="request-headers" class="bg-light p-2 rounded">No request made yet</pre>
                        
                        <h6>Request Body</h6>
                        <pre id="request-body" class="bg-light p-2 rounded">No request made yet</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="notification-container"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
    function handleClick(buttonName, autoSubmit = true) {
        const agentMessage = document.getElementById('agent-message');
        if (agentMessage) {
            agentMessage.value = `User clicked ${buttonName}`;
            
            // Automatically submit the message if autoSubmit is true
            if (autoSubmit) {
                // Find the invoke button and click it
                const invokeButton = document.getElementById('invoke-agent');
                if (invokeButton) {
                    setTimeout(() => invokeButton.click(), 100); // Small delay to ensure the value is set
                }
            }
        }
    }
    </script>
    <script src="js/main.js"></script>
    <script src="js/agent-invoke-stream.js"></script>
</body>
</html>